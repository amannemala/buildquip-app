<!-- Last updated: May 24, 2025 -->
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BuildQuip - Procurement Tracker</title>
    <!-- Add SheetJS library -->
    <script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f8f9fa;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
        }

        h2 {
            color: #444;
            margin-top: 30px;
        }

        .excel-form-container {
            margin-bottom: 30px;
        }

        .excel-form {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
            background-color: white;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .excel-form th,
        .excel-form td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }

        .excel-form th {
            background-color: #f5f5f5;
            font-weight: bold;
        }

        .excel-form input {
            width: 100%;
            padding: 6px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }

        .excel-form input:focus {
            outline: none;
            border-color: #007bff;
        }

        .add-row-btn,
        .submit-all-btn,
        .remove-row-btn {
            padding: 8px 16px;
            margin: 5px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
        }

        .add-row-btn {
            background-color: #28a745;
            color: white;
        }

        .submit-all-btn {
            background-color: #007bff;
            color: white;
        }

        .remove-row-btn {
            background-color: #dc3545;
            color: white;
        }

        .add-row-btn:hover,
        .submit-all-btn:hover,
        .remove-row-btn:hover {
            opacity: 0.9;
        }

        .empty-row td {
            color: #999;
            font-style: italic;
        }

        /* Status Colors */
        .status-delayed {
            background-color: #ffebee;
            color: #c62828;
        }

        .status-tracking {
            background-color: #e8f5e9;
            color: #2e7d32;
        }

        .status-early {
            background-color: #e3f2fd;
            color: #1565c0;
        }

        .status-ontime {
            background-color: #f1f8e9;
            color: #33691e;
        }

        /* Project Management Styles */
        .project-management-area {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .project-form {
            margin-bottom: 20px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }

        .form-group input,
        .form-group textarea {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }

        .form-group textarea {
            height: 100px;
            resize: vertical;
        }

        /* Sidebar Styles */
        .sidebar {
            position: fixed;
            left: 0;
            top: 0;
            bottom: 0;
            width: 200px;
            background-color: #343a40;
            color: white;
            padding: 20px;
            box-shadow: 2px 0 5px rgba(0, 0, 0, 0.1);
        }

        .sidebar h2 {
            color: white;
            margin-bottom: 20px;
            text-align: center;
        }

        .sidebar ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .sidebar ul li {
            margin-bottom: 10px;
        }

        .sidebar ul li a {
            color: white;
            text-decoration: none;
            display: block;
            padding: 10px;
            border-radius: 4px;
            transition: background-color 0.3s;
        }

        .sidebar ul li a:hover {
            background-color: #007bff;
            color: white;
        }

        .main-content {
            margin-left: 220px;
            padding: 20px;
        }

        @media (max-width: 768px) {
            .sidebar {
                width: 100%;
                height: auto;
                position: relative;
                border-right: none;
                border-bottom: 1px solid #ced4da;
            }

            .sidebar h2 {
                display: none;
            }

            .sidebar ul {
                display: flex;
                flex-direction: row;
                justify-content: space-around;
            }

            .sidebar ul li a {
                padding: 10px;
                border-bottom: none;
            }

            .sidebar ul li:first-child a {
                border-top: none;
            }

            .main-content {
                margin-left: 0;
            }
        }

        /* Section styles */
        .section {
            display: none;
            padding: 20px;
        }

        .section.active {
            display: block;
        }

        /* Dashboard styles */
        .overview-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        /* Submittals styles */
        .submittals-content {
            margin-top: 20px;
        }

        /* Procurement styles */
        .procurement-content {
            margin-top: 20px;
        }

        .procurement-form {
            margin-bottom: 40px;
        }

        /* Projects styles */
        .projects-content {
            margin-top: 20px;
        }

        .project-form {
            max-width: 600px;
            margin-bottom: 40px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }

        .form-group input,
        .form-group textarea {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        .form-group textarea {
            height: 100px;
            resize: vertical;
        }

        /* Button styles */
        .button-group {
            margin-top: 20px;
            display: flex;
            gap: 10px;
        }

        .add-row-btn,
        .submit-all-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
        }

        .add-row-btn {
            background-color: #28a745;
            color: white;
        }

        .submit-all-btn {
            background-color: #007bff;
            color: white;
        }

        .add-row-btn:hover,
        .submit-all-btn:hover {
            opacity: 0.9;
        }
    </style>
</head>

<body>
    <div class="sidebar">
        <h2>BuildQuip Menu</h2>
        <ul class="sidebar-nav">
            <li><a href="#" data-section="dashboard">Dashboard</a></li>
            <li><a href="#" data-section="submittals">Submittals</a></li>
            <li><a href="#" data-section="procurement" class="active">Procurement</a></li>
            <li><a href="#" data-section="projects">Projects</a></li>
        </ul>
    </div>

    <div class="main-content">
        <div class="dashboard-section section">
            <h1>Dashboard</h1>
            <div class="overview-stats">
                <!-- Dashboard content will go here -->
            </div>
        </div>

        <div class="submittals-section section">
            <h1>Submittals</h1>
            <div class="submittals-content">
                <form id="submittalsForm">
                    <table class="excel-form">
                        <thead>
                            <tr>
                                <th>Project Name</th>
                                <th>Specifications</th>
                                <th>Title/Product</th>
                                <th>Material ID</th>
                                <th>Vendor/Partner</th>
                                <th>Submittal Manager</th>
                                <th>Submittal Status</th>
                                <th>Date Received from Sub</th>
                                <th>Date Sent to Design Team</th>
                                <th>Due Date</th>
                                <th>Date Review Received</th>
                                <th>Date Issued to Sub</th>
                                <th>Comments</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="submittalsFormBody">
                            <!-- Initial empty row -->
                            <tr class="form-row">
                                <td><input type="text" class="project-name" readonly></td>
                                <td><input type="text" class="specifications" maxlength="8" pattern="\d{1,8}" required
                                        oninput="validateSpecifications(this)" placeholder="Enter 8 digits"></td>
                                <td><input type="text" class="title-product" required></td>
                                <td><input type="text" class="material-id"></td>
                                <td><input type="text" class="vendor-partner"></td>
                                <td><input type="text" class="submittal-manager" required></td>
                                <td>
                                    <select class="submittal-status" required>
                                        <option value="">Select Status</option>
                                        <option value="EAN">EAN</option>
                                        <option value="NEN">NEN</option>
                                        <option value="R&R">R&R</option>
                                        <option value="Closeout">Closeout</option>
                                        <option value="For Record">For Record</option>
                                        <option value="Pending">Pending</option>
                                    </select>
                                </td>
                                <td><input type="date" class="date-received" required></td>
                                <td><input type="date" class="date-sent-design"></td>
                                <td><input type="date" class="due-date" required></td>
                                <td><input type="date" class="date-review-received"></td>
                                <td><input type="date" class="date-issued-sub"></td>
                                <td><input type="text" class="comments"></td>
                                <td>
                                    <button type="button" class="remove-row-btn"
                                        onclick="removeSubmittalRow(this)">Remove</button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                    <div class="button-group">
                        <button type="button" class="add-row-btn" onclick="addNewSubmittalRow()">Add Row</button>
                        <button type="button" class="submit-all-btn" onclick="submitAllSubmittals()">Submit All</button>
                    </div>
                </form>
                <div class="submittals-table">
                    <h2>Submittals Log</h2>
                    <table class="excel-form">
                        <thead>
                            <tr>
                                <th>Project Name</th>
                                <th>Specifications</th>
                                <th>Title/Product</th>
                                <th>Material ID</th>
                                <th>Vendor/Partner</th>
                                <th>Submittal Manager</th>
                                <th>Submittal Status</th>
                                <th>Date Received from Sub</th>
                                <th>Date Sent to Design Team</th>
                                <th>Due Date</th>
                                <th>Date Review Received</th>
                                <th>Date Issued to Sub</th>
                                <th>Comments</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="submittalsTableBody">
                            <!-- Table rows will be added here -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <div class="procurement-section section active">
            <h1>Procurement</h1>
            <div class="procurement-content">
                <form id="procurementForm">
                    <table class="excel-form">
                        <thead>
                            <tr>
                                <th>Project Name</th>
                                <th>Specifications</th>
                                <th>Title/Product</th>
                                <th>Material ID</th>
                                <th>Vendor/Partner</th>
                                <th>Required On-site Date</th>
                                <th>Lead Time (weeks)</th>
                                <th>Drop Dead Date</th>
                                <th>Order Date</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="procurementFormBody">
                            <!-- Initial empty row -->
                            <tr class="form-row">
                                <td><input type="text" class="project-name" readonly></td>
                                <td><input type="text" class="specifications" maxlength="8" pattern="\d{1,8}" required
                                        oninput="validateSpecifications(this)" placeholder="Enter 8 digits"></td>
                                <td><input type="text" class="title-product" required></td>
                                <td><input type="text" class="material-id"></td>
                                <td><input type="text" class="vendor-partner"></td>
                                <td><input type="date" class="required-onsite-date" required
                                        onchange="calculateDropDeadDate(this)"></td>
                                <td><input type="number" class="lead-time" min="0" step="1" required
                                        onchange="calculateDropDeadDate(this)"></td>
                                <td><input type="date" class="drop-dead-date" readonly></td>
                                <td><input type="date" class="order-date" required onchange="updateStatus(this)"></td>
                                <td><input type="text" class="status" readonly></td>
                                <td>
                                    <button type="button" class="remove-row-btn"
                                        onclick="removeRow(this)">Remove</button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                    <div class="button-group">
                        <button type="button" class="add-row-btn" onclick="addNewRow()">Add Row</button>
                        <button type="button" class="submit-all-btn" onclick="submitAllItems()">Submit All</button>
                    </div>
                </form>
                <div class="procurement-table">
                    <h2>Procurement Log</h2>
                    <table class="excel-form">
                        <thead>
                            <tr>
                                <th>Project Name</th>
                                <th>Specifications</th>
                                <th>Title/Product</th>
                                <th>Material ID</th>
                                <th>Vendor/Partner</th>
                                <th>Required On-site Date</th>
                                <th>Lead Time</th>
                                <th>Drop Dead Date</th>
                                <th>Order Date</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="procurementTableBody">
                            <!-- Table rows will be added here -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <div class="projects-section section">
            <h1>Projects</h1>
            <div class="projects-content">
                <form id="projectForm" class="project-form">
                    <div class="form-group">
                        <label for="projectNameInput">Project Name</label>
                        <input type="text" id="projectNameInput" required>
                    </div>
                    <div class="form-group">
                        <label for="projectBudgetInput">Project Budget</label>
                        <input type="number" id="projectBudgetInput" required>
                    </div>
                    <div class="form-group">
                        <label for="projectEndDateInput">Target End Date</label>
                        <input type="date" id="projectEndDateInput" required>
                    </div>
                    <div class="form-group">
                        <label>Upload Material List (optional)</label>
                        <input type="file" id="materialListFile" accept=".xlsx,.xls,.csv">
                        <input type="text" id="materialListSheet" placeholder="Paste Google Sheets CSV link">
                    </div>
                    <button type="button" onclick="addProject()" class="submit-all-btn">Add Project</button>
                </form>
                <div class="projects-table">
                    <table class="excel-form">
                        <thead>
                            <tr>
                                <th>Project Name</th>
                                <th>Budget</th>
                                <th>Target End Date</th>
                            </tr>
                        </thead>
                        <tbody id="projectTableBody">
                            <!-- Project rows will be added here -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Initialize the page with Procurement section active
        document.addEventListener('DOMContentLoaded', function () {
            // Set default section to Procurement
            showSection('procurement');

            // Load saved items from localStorage
            loadSavedItems();
            loadSavedSubmittals();

            // Add click handlers to navigation links
            document.querySelectorAll('.sidebar-nav a').forEach(link => {
                link.addEventListener('click', function (e) {
                    e.preventDefault();
                    const section = this.getAttribute('data-section');
                    showSection(section);

                    // Update active state in navigation
                    document.querySelectorAll('.sidebar-nav a').forEach(navLink => {
                        navLink.classList.remove('active');
                    });
                    this.classList.add('active');
                });
            });
        });

        // Function to show the selected section and hide others
        function showSection(section) {
            // Hide all sections
            document.querySelectorAll('.section').forEach(s => {
                s.classList.remove('active');
            });

            // Show the selected section
            const selectedSection = document.querySelector(`.${section}-section`);
            if (selectedSection) {
                selectedSection.classList.add('active');
            }
        }

        // Validate specifications input
        function validateSpecifications(input) {
            let value = input.value.replace(/\D/g, ''); // Remove non-digits
            if (value.length > 8) {
                value = value.slice(0, 8); // Keep only first 8 digits
            }
            input.value = value;
        }

        // Calculate drop dead date based on required date and lead time
        function calculateDropDeadDate(input) {
            const row = input.closest('tr');
            const requiredDate = row.querySelector('.required-onsite-date').value;
            const leadTime = row.querySelector('.lead-time').value;

            if (requiredDate && leadTime) {
                const date = new Date(requiredDate);
                date.setDate(date.getDate() - (leadTime * 7)); // Convert weeks to days
                const dropDeadDate = row.querySelector('.drop-dead-date');
                dropDeadDate.value = date.toISOString().split('T')[0];

                // Update status if order date exists
                const orderDate = row.querySelector('.order-date').value;
                if (orderDate) {
                    updateStatus(row.querySelector('.order-date'));
                }
            }
        }

        // Update status based on order date and drop dead date
        function updateStatus(input) {
            const row = input.closest('tr');
            const orderDate = new Date(input.value);
            const dropDeadDate = new Date(row.querySelector('.drop-dead-date').value);
            const status = row.querySelector('.status');

            if (orderDate && dropDeadDate) {
                const diffDays = Math.ceil((orderDate - dropDeadDate) / (1000 * 60 * 60 * 24));

                if (diffDays > 0) {
                    status.value = 'Delayed';
                    status.className = 'status status-delayed';
                } else if (diffDays === 0) {
                    status.value = 'On Time';
                    status.className = 'status status-ontime';
                } else {
                    status.value = 'Early';
                    status.className = 'status status-early';
                }
            }
        }

        // Add new row to procurement form
        function addNewRow() {
            const tbody = document.getElementById('procurementFormBody');
            const newRow = document.createElement('tr');
            newRow.className = 'form-row';
            newRow.innerHTML = `
                <td><input type="text" class="project-name" readonly></td>
                <td><input type="text" class="specifications" maxlength="8" pattern="\d{1,8}" required oninput="validateSpecifications(this)" placeholder="Enter 8 digits"></td>
                <td><input type="text" class="title-product" required></td>
                <td><input type="text" class="material-id"></td>
                <td><input type="text" class="vendor-partner"></td>
                <td><input type="date" class="required-onsite-date" required onchange="calculateDropDeadDate(this)"></td>
                <td><input type="number" class="lead-time" min="0" step="1" required onchange="calculateDropDeadDate(this)"></td>
                <td><input type="date" class="drop-dead-date" readonly></td>
                <td><input type="date" class="order-date" required onchange="updateStatus(this)"></td>
                <td><input type="text" class="status" readonly></td>
                <td>
                    <button type="button" class="remove-row-btn" onclick="removeRow(this)">Remove</button>
                </td>
            `;
            tbody.appendChild(newRow);
        }

        // Remove row from procurement form
        function removeRow(button) {
            const row = button.closest('tr');
            row.remove();
        }

        // Load saved items from localStorage
        function loadSavedItems() {
            const savedItems = JSON.parse(localStorage.getItem('procurementItems') || '[]');
            const tableBody = document.getElementById('procurementTableBody');

            savedItems.forEach(item => {
                const newRow = document.createElement('tr');
                newRow.innerHTML = `
                    <td>${item.specifications}</td>
                    <td>${item.titleProduct}</td>
                    <td>${item.materialId}</td>
                    <td>${item.vendorPartner}</td>
                    <td>${item.requiredDate}</td>
                    <td>${item.leadTime}</td>
                    <td>${item.dropDeadDate}</td>
                    <td>${item.orderDate}</td>
                    <td>${item.status}</td>
                    <td>
                        <button type="button" class="remove-row-btn" onclick="removeTableRow(this)">Remove</button>
                    </td>
                `;
                tableBody.appendChild(newRow);
            });
        }

        // Save items to localStorage
        function saveItems() {
            const tableBody = document.getElementById('procurementTableBody');
            const items = [];

            tableBody.querySelectorAll('tr').forEach(row => {
                const cells = row.querySelectorAll('td');
                items.push({
                    specifications: cells[0].textContent,
                    titleProduct: cells[1].textContent,
                    materialId: cells[2].textContent,
                    vendorPartner: cells[3].textContent,
                    requiredDate: cells[4].textContent,
                    leadTime: cells[5].textContent,
                    dropDeadDate: cells[6].textContent,
                    orderDate: cells[7].textContent,
                    status: cells[8].textContent
                });
            });

            localStorage.setItem('procurementItems', JSON.stringify(items));
        }

        // Submit all items
        function submitAllItems() {
            const formRows = document.querySelectorAll('#procurementFormBody tr');
            const tableBody = document.getElementById('procurementTableBody');

            formRows.forEach(row => {
                // Only submit if required fields are filled
                const specifications = row.querySelector('.specifications').value;
                const titleProduct = row.querySelector('.title-product').value;
                const requiredDate = row.querySelector('.required-onsite-date').value;
                const leadTime = row.querySelector('.lead-time').value;
                const orderDate = row.querySelector('.order-date').value;

                if (specifications && titleProduct && requiredDate && leadTime && orderDate) {
                    const newRow = document.createElement('tr');
                    newRow.innerHTML = `
                        <td>${specifications}</td>
                        <td>${titleProduct}</td>
                        <td>${row.querySelector('.material-id').value}</td>
                        <td>${row.querySelector('.vendor-partner').value}</td>
                        <td>${requiredDate}</td>
                        <td>${leadTime}</td>
                        <td>${row.querySelector('.drop-dead-date').value}</td>
                        <td>${orderDate}</td>
                        <td>${row.querySelector('.status').value}</td>
                        <td>
                            <button type="button" class="remove-row-btn" onclick="removeTableRow(this)">Remove</button>
                        </td>
                    `;
                    tableBody.appendChild(newRow);
                }
            });

            // Save to localStorage after adding new items
            saveItems();

            // Clear the form
            document.getElementById('procurementFormBody').innerHTML = `
                <tr class="form-row">
                    <td><input type="text" class="project-name" readonly></td>
                    <td><input type="text" class="specifications" maxlength="8" pattern="\d{1,8}" required oninput="validateSpecifications(this)" placeholder="Enter 8 digits"></td>
                    <td><input type="text" class="title-product" required></td>
                    <td><input type="text" class="material-id"></td>
                    <td><input type="text" class="vendor-partner"></td>
                    <td><input type="date" class="required-onsite-date" required onchange="calculateDropDeadDate(this)"></td>
                    <td><input type="number" class="lead-time" min="0" step="1" required onchange="calculateDropDeadDate(this)"></td>
                    <td><input type="date" class="drop-dead-date" readonly></td>
                    <td><input type="date" class="order-date" required onchange="updateStatus(this)"></td>
                    <td><input type="text" class="status" readonly></td>
                    <td>
                        <button type="button" class="remove-row-btn" onclick="removeRow(this)">Remove</button>
                    </td>
                </tr>
            `;
        }

        // Remove row from procurement table
        function removeTableRow(button) {
            const row = button.closest('tr');
            row.remove();
            // Save to localStorage after removing an item
            saveItems();
        }

        // Add new row to submittals form
        function addNewSubmittalRow() {
            const tbody = document.getElementById('submittalsFormBody');
            const newRow = document.createElement('tr');
            newRow.className = 'form-row';
            newRow.innerHTML = `
                <td><input type="text" class="project-name" value="${data.project}" readonly></td>
                <td><input type="text" class="specifications" value="${data.specifications}" maxlength="8" pattern="\d{1,8}" required oninput="validateSpecifications(this)" placeholder="Enter 8 digits"></td>
                <td><input type="text" class="title-product" value="${data.title}" required></td>
                <td><input type="text" class="material-id" value="${data.materialId}"></td>
                <td><input type="text" class="vendor-partner" value="${data.vendor}"></td>
                <td><input type="text" class="submittal-manager" required></td>
                <td>
                    <select class="submittal-status" required>
                        <option value="">Select Status</option>
                        <option value="EAN">EAN</option>
                        <option value="NEN">NEN</option>
                        <option value="R&R">R&R</option>
                        <option value="Closeout">Closeout</option>
                        <option value="For Record">For Record</option>
                        <option value="Pending">Pending</option>
                    </select>
                </td>
                <td><input type="date" class="date-received" required></td>
                <td><input type="date" class="date-sent-design"></td>
                <td><input type="date" class="due-date" required></td>
                <td><input type="date" class="date-review-received"></td>
                <td><input type="date" class="date-issued-sub"></td>
                <td><input type="text" class="comments"></td>
                <td>
                    <button type="button" class="remove-row-btn" onclick="removeSubmittalRow(this)">Remove</button>
                </td>
            `;
            tbody.appendChild(newRow);
        }

        // Remove row from submittals form
        function removeSubmittalRow(button) {
            const row = button.closest('tr');
            row.remove();
        }

        // Submit all submittals
        function submitAllSubmittals() {
            const formRows = document.querySelectorAll('#submittalsFormBody tr');
            const tableBody = document.getElementById('submittalsTableBody');

            formRows.forEach(row => {
                // Only submit if required fields are filled
                const specifications = row.querySelector('.specifications').value;
                const titleProduct = row.querySelector('.title-product').value;
                const submittalManager = row.querySelector('.submittal-manager').value;
                const submittalStatus = row.querySelector('.submittal-status').value;
                const dateReceived = row.querySelector('.date-received').value;
                const dueDate = row.querySelector('.due-date').value;

                if (specifications && titleProduct && submittalManager && submittalStatus && dateReceived && dueDate) {
                    const newRow = document.createElement('tr');
                    newRow.innerHTML = `
                        <td>${specifications}</td>
                        <td>${titleProduct}</td>
                        <td>${row.querySelector('.material-id').value}</td>
                        <td>${row.querySelector('.vendor-partner').value}</td>
                        <td>${submittalManager}</td>
                        <td>${submittalStatus}</td>
                        <td>${dateReceived}</td>
                        <td>${row.querySelector('.date-sent-design').value}</td>
                        <td>${dueDate}</td>
                        <td>${row.querySelector('.date-review-received').value}</td>
                        <td>${row.querySelector('.date-issued-sub').value}</td>
                        <td>${row.querySelector('.comments').value}</td>
                        <td>
                            <button type="button" class="remove-row-btn" onclick="removeSubmittalTableRow(this)">Remove</button>
                        </td>
                    `;
                    tableBody.appendChild(newRow);
                }
            });

            // Save to localStorage after adding new items
            saveSubmittals();

            // Clear the form
            document.getElementById('submittalsFormBody').innerHTML = `
                <tr class="form-row">
                    <td><input type="text" class="project-name" readonly></td>
                    <td><input type="text" class="specifications" maxlength="8" pattern="\d{1,8}" required oninput="validateSpecifications(this)" placeholder="Enter 8 digits"></td>
                    <td><input type="text" class="title-product" required></td>
                    <td><input type="text" class="material-id"></td>
                    <td><input type="text" class="vendor-partner"></td>
                    <td><input type="text" class="submittal-manager" required></td>
                    <td>
                        <select class="submittal-status" required>
                            <option value="">Select Status</option>
                            <option value="EAN">EAN</option>
                            <option value="NEN">NEN</option>
                            <option value="R&R">R&R</option>
                            <option value="Closeout">Closeout</option>
                            <option value="For Record">For Record</option>
                            <option value="Pending">Pending</option>
                        </select>
                    </td>
                    <td><input type="date" class="date-received" required></td>
                    <td><input type="date" class="date-sent-design"></td>
                    <td><input type="date" class="due-date" required></td>
                    <td><input type="date" class="date-review-received"></td>
                    <td><input type="date" class="date-issued-sub"></td>
                    <td><input type="text" class="comments"></td>
                    <td>
                        <button type="button" class="remove-row-btn" onclick="removeSubmittalRow(this)">Remove</button>
                    </td>
                </tr>
            `;
        }

        // Remove row from submittals table
        function removeSubmittalTableRow(button) {
            const row = button.closest('tr');
            row.remove();
            // Save to localStorage after removing an item
            saveSubmittals();
        }

        // Save submittals to localStorage
        function saveSubmittals() {
            const tableBody = document.getElementById('submittalsTableBody');
            const items = [];

            tableBody.querySelectorAll('tr').forEach(row => {
                const cells = row.querySelectorAll('td');
                items.push({
                    specifications: cells[0].textContent,
                    titleProduct: cells[1].textContent,
                    materialId: cells[2].textContent,
                    vendorPartner: cells[3].textContent,
                    submittalManager: cells[4].textContent,
                    submittalStatus: cells[5].textContent,
                    dateReceived: cells[6].textContent,
                    dateSentDesign: cells[7].textContent,
                    dueDate: cells[8].textContent,
                    dateReviewReceived: cells[9].textContent,
                    dateIssuedSub: cells[10].textContent,
                    comments: cells[11].textContent
                });
            });

            localStorage.setItem('submittalsItems', JSON.stringify(items));
        }

        // Load saved submittals from localStorage
        function loadSavedSubmittals() {
            const savedItems = JSON.parse(localStorage.getItem('submittalsItems') || '[]');
            const tableBody = document.getElementById('submittalsTableBody');

            savedItems.forEach(item => {
                const newRow = document.createElement('tr');
                newRow.innerHTML = `
                    <td>${item.specifications}</td>
                    <td>${item.titleProduct}</td>
                    <td>${item.materialId}</td>
                    <td>${item.vendorPartner}</td>
                    <td>${item.submittalManager}</td>
                    <td>${item.submittalStatus}</td>
                    <td>${item.dateReceived}</td>
                    <td>${item.dateSentDesign}</td>
                    <td>${item.dueDate}</td>
                    <td>${item.dateReviewReceived}</td>
                    <td>${item.dateIssuedSub}</td>
                    <td>${item.comments}</td>
                    <td>
                        <button type="button" class="remove-row-btn" onclick="removeSubmittalTableRow(this)">Remove</button>
                    </td>
                `;
                tableBody.appendChild(newRow);
            });
        }

        // Project management
        let projects = JSON.parse(localStorage.getItem('projects') || '[]');
        let pendingMaterialListRows = null;

        // Listen for file upload in the project form
        const materialListFileInput = document.getElementById('materialListFile');
        if (materialListFileInput) {
            materialListFileInput.addEventListener('change', function (event) {
                const file = event.target.files[0];
                if (!file) return;
                const reader = new FileReader();
                reader.onload = function (e) {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, { type: 'array' });
                    const sheet = workbook.Sheets[workbook.SheetNames[0]];
                    const rows = XLSX.utils.sheet_to_json(sheet, { header: 1 });
                    pendingMaterialListRows = rows;
                };
                reader.readAsArrayBuffer(file);
            });
        }
        // Listen for Google Sheets link in the project form
        const materialListSheetInput = document.getElementById('materialListSheet');
        if (materialListSheetInput) {
            materialListSheetInput.addEventListener('blur', function (event) {
                const url = event.target.value.trim();
                if (!url) return;
                fetch(url)
                    .then(res => res.text())
                    .then(csv => {
                        const rows = XLSX.utils.sheet_to_json(XLSX.read(csv, { type: 'string' }).Sheets.Sheet1, { header: 1 });
                        pendingMaterialListRows = rows;
                    })
                    .catch(() => alert('Failed to fetch Google Sheet. Make sure it is published as CSV.'));
            });
        }
        // Update addProject to use pendingMaterialListRows
        function addProject() {
            const name = document.getElementById('projectNameInput').value.trim();
            const budget = document.getElementById('projectBudgetInput').value.trim();
            const endDate = document.getElementById('projectEndDateInput').value;
            if (!name || !budget || !endDate) return alert('Fill all fields');
            projects.push({ name, budget, endDate });
            localStorage.setItem('projects', JSON.stringify(projects));
            renderProjects();
            // If a material list was uploaded, ingest it for this project
            if (pendingMaterialListRows) {
                ingestMaterialList(pendingMaterialListRows, name);
                pendingMaterialListRows = null;
                document.getElementById('materialListFile').value = '';
                document.getElementById('materialListSheet').value = '';
            }
            document.getElementById('projectForm').reset();
        }
        function renderProjects() {
            const tbody = document.querySelector('#projectTableBody');
            tbody.innerHTML = '';
            projects.forEach((p, idx) => {
                tbody.innerHTML += `<tr>
                    <td>${p.name}</td>
                    <td>${p.budget}</td>
                    <td>${p.endDate}</td>
                </tr>`;
            });
        }
        window.addEventListener('DOMContentLoaded', renderProjects);
        // File upload handler
        function handleFileUpload(event, projectName) {
            const file = event.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = function (e) {
                const data = new Uint8Array(e.target.result);
                const workbook = XLSX.read(data, { type: 'array' });
                const sheet = workbook.Sheets[workbook.SheetNames[0]];
                const rows = XLSX.utils.sheet_to_json(sheet, { header: 1 });
                ingestMaterialList(rows, projectName);
            };
            reader.readAsArrayBuffer(file);
        }
        // Google Sheets CSV link handler
        function handleSheetLink(event, projectName) {
            const url = event.target.value.trim();
            if (!url) return;
            fetch(url)
                .then(res => res.text())
                .then(csv => {
                    const rows = XLSX.utils.sheet_to_json(XLSX.read(csv, { type: 'string' }).Sheets.Sheet1, { header: 1 });
                    ingestMaterialList(rows, projectName);
                })
                .catch(() => alert('Failed to fetch Google Sheet. Make sure it is published as CSV.'));
        }
        // Ingest and prepopulate Submittals and Procurement
        function ingestMaterialList(rows, projectName) {
            if (!rows || rows.length < 2) return alert('No data found');
            const headers = rows[0].map(h => h.toLowerCase());
            const specIdx = headers.indexOf('specifications');
            const titleIdx = headers.indexOf('title/product');
            const matIdIdx = headers.indexOf('material id');
            const vendorIdx = headers.indexOf('vendor/partner');
            if (specIdx === -1 || titleIdx === -1 || matIdIdx === -1 || vendorIdx === -1) {
                alert('Missing required columns.');
                return;
            }
            // Clear form bodies before adding new rows
            document.getElementById('submittalsFormBody').innerHTML = '';
            document.getElementById('procurementFormBody').innerHTML = '';
            let added = 0;
            for (let i = 1; i < rows.length; i++) {
                const row = rows[i];
                // Prepopulate Submittals
                addSubmittalRow({
                    project: projectName,
                    specifications: row[specIdx] || '',
                    title: row[titleIdx] || '',
                    materialId: row[matIdIdx] || '',
                    vendor: row[vendorIdx] || ''
                });
                // Prepopulate Procurement
                addProcurementRow({
                    project: projectName,
                    specifications: row[specIdx] || '',
                    title: row[titleIdx] || '',
                    materialId: row[matIdIdx] || '',
                    vendor: row[vendorIdx] || ''
                });
                added++;
            }
            // If no rows were added, add a default empty row
            if (added === 0) {
                addSubmittalRow({ project: projectName, specifications: '', title: '', materialId: '', vendor: '' });
                addProcurementRow({ project: projectName, specifications: '', title: '', materialId: '', vendor: '' });
            }
        }
        // Add row helpers (implement these to add a row to the respective tables)
        function addSubmittalRow(data) {
            const tbody = document.getElementById('submittalsFormBody');
            const newRow = document.createElement('tr');
            newRow.className = 'form-row';
            newRow.innerHTML = `
                <td><input type="text" class="project-name" value="${data.project}" readonly></td>
                <td><input type="text" class="specifications" value="${data.specifications}" maxlength="8" pattern="\d{1,8}" required oninput="validateSpecifications(this)" placeholder="Enter 8 digits"></td>
                <td><input type="text" class="title-product" value="${data.title}" required></td>
                <td><input type="text" class="material-id" value="${data.materialId}"></td>
                <td><input type="text" class="vendor-partner" value="${data.vendor}"></td>
                <td><input type="text" class="submittal-manager" required></td>
                <td>
                    <select class="submittal-status" required>
                        <option value="">Select Status</option>
                        <option value="EAN">EAN</option>
                        <option value="NEN">NEN</option>
                        <option value="R&R">R&R</option>
                        <option value="Closeout">Closeout</option>
                        <option value="For Record">For Record</option>
                        <option value="Pending">Pending</option>
                    </select>
                </td>
                <td><input type="date" class="date-received" required></td>
                <td><input type="date" class="date-sent-design"></td>
                <td><input type="date" class="due-date" required></td>
                <td><input type="date" class="date-review-received"></td>
                <td><input type="date" class="date-issued-sub"></td>
                <td><input type="text" class="comments"></td>
                <td>
                    <button type="button" class="remove-row-btn" onclick="removeSubmittalRow(this)">Remove</button>
                </td>
            `;
            tbody.appendChild(newRow);
        }
        function addProcurementRow(data) {
            const tbody = document.getElementById('procurementFormBody');
            const newRow = document.createElement('tr');
            newRow.className = 'form-row';
            newRow.innerHTML = `
                <td><input type="text" class="project-name" value="${data.project}" readonly></td>
                <td><input type="text" class="specifications" value="${data.specifications}" maxlength="8" pattern="\d{1,8}" required oninput="validateSpecifications(this)" placeholder="Enter 8 digits"></td>
                <td><input type="text" class="title-product" value="${data.title}" required></td>
                <td><input type="text" class="material-id" value="${data.materialId}"></td>
                <td><input type="text" class="vendor-partner" value="${data.vendor}"></td>
                <td><input type="date" class="required-onsite-date" required onchange="calculateDropDeadDate(this)"></td>
                <td><input type="number" class="lead-time" min="0" step="1" required onchange="calculateDropDeadDate(this)"></td>
                <td><input type="date" class="drop-dead-date" readonly></td>
                <td><input type="date" class="order-date" required onchange="updateStatus(this)"></td>
                <td><input type="text" class="status" readonly></td>
                <td>
                    <button type="button" class="remove-row-btn" onclick="removeRow(this)">Remove</button>
                </td>
            `;
            tbody.appendChild(newRow);
        }
    </script>
</body>

</html>